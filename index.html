<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è´¦å·ç›‘æ§æ± </title>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <style>
        /* ğŸ“± åŸºç¡€æ ·å¼ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f5f6f7;
            margin: 0;
            padding: 15px;
            color: #1f2329;
            -webkit-tap-highlight-color: transparent;
        }

        h2 { text-align: center; font-size: 18px; margin: 10px 0 5px 0; color: #000; }
        
        .visitor-count {
            text-align: center;
            font-size: 12px;
            color: #646a73;
            margin-bottom: 5px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .visitor-count span { font-family: monospace; font-weight: bold; color: #3370ff; }
        
        /* é”å®šæç¤ºæ¡ */
        .lock-tip { 
            text-align: center; font-size: 12px; color: #d0021b; 
            margin-bottom: 15px; background: #fff0f0; padding: 8px; 
            border-radius: 6px; border: 1px solid #ffdbdb; display: none; 
        }

        .tutorial-section {
            background: #fff; border-radius: 12px; padding: 15px; 
            margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04); 
            border: 1px solid #dee0e3;
        }
        
        .tutorial-title {
            font-weight: bold; color: #d0021b; margin-bottom: 10px; 
            font-size: 15px; text-align: center;
        }

        .image-row { display: flex; justify-content: center; align-items: center; gap: 10px; }
        .side-by-side-img { width: 48%; height: auto; border-radius: 6px; border: 1px solid #eee; cursor: zoom-in; object-fit: cover; }

        .image-modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); align-items: center; justify-content: center; animation: fadeIn 0.2s; }
        .modal-content { margin: auto; display: block; max-width: 95%; max-height: 95%; border-radius: 5px; }
        .modal-tip { position: absolute; bottom: 20px; color: #fff; font-size: 14px; background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px; }
        @keyframes fadeIn { from {opacity: 0} to {opacity: 1} }

        .card { background: #fff; border-radius: 12px; padding: 16px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04); border: 1px solid #dee0e3; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px dashed #eff0f1; }
        .region-badge { font-weight: 700; font-size: 16px; display: flex; align-items: center; }
        .region-badge::before { content: ''; display: inline-block; width: 4px; height: 16px; background: #3370ff; margin-right: 8px; border-radius: 2px; }
        .status-badge { font-size: 12px; padding: 2px 8px; border-radius: 4px; background: #eafff2; color: #00b656; }
        .row { margin-bottom: 12px; }
        .row:last-child { margin-bottom: 0; }
        .label { font-size: 12px; color: #8f959e; margin-bottom: 4px; }
        .value-box { display: flex; align-items: center; background: #f5f6f7; border-radius: 6px; padding: 10px; border: 1px solid #dee0e3; position: relative; }
        .value-text { flex: 1; font-family: "SF Mono", Consolas, monospace; font-size: 14px; word-break: break-all; margin-right: 10px; }
        .copy-btn { background: #3370ff; color: white; border: none; border-radius: 4px; padding: 6px 12px; font-size: 12px; font-weight: 600; cursor: pointer; white-space: nowrap; }
        .copy-btn:active { opacity: 0.8; transform: scale(0.95); }
        .copy-btn.copied { background: #00b656; }
        .footer { text-align: right; font-size: 11px; color: #bbbfc4; margin-top: 8px; }

        /* ğŸ‘‡ğŸ‘‡ğŸ‘‡ æ–°å¢ï¼šå¯†ç å¼¹çª—æ ·å¼ ğŸ‘‡ğŸ‘‡ğŸ‘‡ */
        .password-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 1); /* ç™½è‰²èƒŒæ™¯é®æŒ¡å†…å®¹ */
            z-index: 10000;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column;
        }
        .pwd-box {
            background: #fff; padding: 30px; border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center; width: 80%; max-width: 300px;
        }
        .pwd-input {
            width: 100%; padding: 10px; margin: 15px 0;
            border: 1px solid #dee0e3; border-radius: 6px;
            font-size: 16px; text-align: center; letter-spacing: 2px;
            box-sizing: border-box; /* ä¿®å¤å®½åº¦æº¢å‡º */
        }
        .pwd-btn {
            width: 100%; padding: 10px; background: #3370ff;
            color: white; border: none; border-radius: 6px;
            font-size: 16px; font-weight: bold; cursor: pointer;
        }
        .pwd-hint { font-size: 12px; color: #8f959e; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="passwordOverlay" class="password-overlay">
        <div class="pwd-box">
            <h3 style="margin-top:0">ğŸ”’ è®¿é—®å—é™</h3>
            <p style="font-size:13px;color:#666">è¯·è¾“å…¥å¯†ç åˆ·æ–°æ•°æ®</p>
            <input type="tel" id="pwdInput" class="pwd-input" placeholder="è¾“å…¥4ä½å¯†ç " maxlength="4">
            <button class="pwd-btn" onclick="checkPassword()">è§£é” / æ›´æ–°</button>
            <div class="pwd-hint">è¾“å…¥æ­£ç¡®å¯†ç å°†å¼ºåˆ¶æ›´æ–°æ•°æ®</div>
        </div>
    </div>
    <h2>âš¡ï¸ å®æ—¶è´¦å·æ± </h2>
    
    <div class="visitor-count">
        <span id="busuanzi_container_site_uv" style="display:none">ğŸ‘¤ è®¿å®¢: <span id="busuanzi_value_site_uv">--</span></span>
        <span id="busuanzi_container_site_pv" style="display:none">ğŸ‘ï¸ æµè§ˆ: <span id="busuanzi_value_site_pv">--</span></span>
    </div>

    <div class="lock-tip" id="lock-tip"></div>
    <div class="refresh-tip" id="status-tip" style="display:none">æ­£åœ¨è·å–æœ€æ–°æ•°æ®...</div>

    <div class="tutorial-section">
        <div class="tutorial-title">âš ï¸ ä½¿ç”¨å‰å¿…çœ‹ (ç‚¹å‡»å›¾ç‰‡æ”¾å¤§)</div>
        <div class="image-row">
            <img src="./warning.png" class="side-by-side-img" onclick="openModal(this)" alt="è­¦å‘Š">
            <img src="./guide.jpg" class="side-by-side-img" onclick="openModal(this)" alt="æ•™ç¨‹">
        </div>
    </div>

    <div id="app"></div>

    <div id="imageModal" class="image-modal" onclick="closeModal()">
        <img class="modal-content" id="modalImg">
        <div class="modal-tip">ç‚¹å‡»ä»»æ„å¤„å…³é—­</div>
    </div>

    <script>
        // ===========================================
        // ğŸ‘‡ğŸ‘‡ğŸ‘‡ é…ç½®åŒºåŸŸ ğŸ‘‡ğŸ‘‡ğŸ‘‡
        const LOCK_HOURS = 12; // é”å®šæ—¶é—´ï¼š12å°æ—¶
        const CACHE_KEY = 'woko_data_cache_v1';
        const PASSWORD = '6666'; // ğŸ”‘ è®¾ç½®å¯†ç 
        // ===========================================

        const dataUrl = `./data.json?t=${new Date().getTime()}`;

        // é¡µé¢åŠ è½½æ—¶ï¼Œæ£€æŸ¥æ˜¯å¦å·²ç»ç™»å½•è¿‡
        window.onload = function() {
            // å¦‚æœ sessionStorage é‡Œæœ‰æ ‡è®°ï¼Œè¯´æ˜è¿™æ¬¡ä¼šè¯å·²ç»è¾“è¿‡å¯†ç äº†ï¼Œç›´æ¥åŠ è½½
            if (sessionStorage.getItem('isLoggedIn') === 'true') {
                document.getElementById('passwordOverlay').style.display = 'none';
                initData(false); // false ä»£è¡¨ä¸å¼ºåˆ¶åˆ·æ–°ï¼Œèµ°æ™®é€šé€»è¾‘
            }
        }

        // ğŸ” å¯†ç éªŒè¯å‡½æ•°
        function checkPassword() {
            const input = document.getElementById('pwdInput').value;
            if (input === PASSWORD) {
                // 1. å¯†ç æ­£ç¡®ï¼Œéšè—å¼¹çª—
                document.getElementById('passwordOverlay').style.display = 'none';
                
                // 2. è®°å…¥ Session (å…³é—­æµè§ˆå™¨å¤±æ•ˆ)ï¼Œé¿å…åˆ·æ–°é‡å¤è¾“
                sessionStorage.setItem('isLoggedIn', 'true');
                
                // 3. ğŸ”¥ğŸ”¥ğŸ”¥ æ ¸å¿ƒï¼šæ¸…é™¤ 12å°æ—¶é”å®šçš„ç¼“å­˜ ğŸ”¥ğŸ”¥ğŸ”¥
                localStorage.removeItem(CACHE_KEY);
                console.log("ğŸ”‘ å¯†ç æ­£ç¡®ï¼Œå¼ºåˆ¶æ¸…é™¤ç¼“å­˜ï¼");

                // 4. åŠ è½½æ•°æ® (å¼ºåˆ¶æ¨¡å¼)
                initData(true); 
            } else {
                alert('âŒ å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•');
                document.getElementById('pwdInput').value = '';
            }
        }

        // æ•°æ®åŠ è½½é€»è¾‘
        function initData(forceUpdate) {
            const app = document.getElementById('app');
            const lockTip = document.getElementById('lock-tip');
            const statusTip = document.getElementById('status-tip');
            
            // 1. æ£€æŸ¥æœ¬åœ°ç¼“å­˜ (å¦‚æœ forceUpdate ä¸º trueï¼Œåˆ™è·³è¿‡æ£€æŸ¥ç›´æ¥è¯·æ±‚)
            const cachedString = localStorage.getItem(CACHE_KEY);
            
            if (!forceUpdate && cachedString) {
                const cached = JSON.parse(cachedString);
                const now = new Date().getTime();
                const diff = now - cached.timestamp;
                const lockTime = LOCK_HOURS * 60 * 60 * 1000;

                // å¦‚æœç¼“å­˜æ²¡è¿‡æœŸ
                if (diff < lockTime) {
                    renderCards(cached.data);
                    
                    const remaining = lockTime - diff;
                    const hours = Math.floor((remaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                    
                    lockTip.style.display = 'block';
                    lockTip.innerHTML = `ğŸ”’ æ•°æ®å·²é”å®š (é˜²åˆ·æœºåˆ¶)<br>ä¸‹æ¬¡æ›´æ–°ï¼š${hours}å°æ—¶${minutes}åˆ†å`;
                    return; 
                }
            }

            // 2. è¯·æ±‚ç½‘ç»œ (æ²¡ç¼“å­˜ï¼Œæˆ–è¢«å¯†ç å¼ºåˆ¶æ¸…é™¤äº†)
            console.log("ğŸŒ æ­£åœ¨è¯·æ±‚æ–°æ•°æ®...");
            statusTip.style.display = 'block';
            if(forceUpdate) lockTip.style.display = 'none'; // å¼ºåˆ¶æ›´æ–°æ—¶å…ˆéšè—æ—§æç¤º
            
            fetch(dataUrl)
                .then(res => {
                    if (!res.ok) throw new Error("è¿æ¥æ•°æ®æºä¸­...");
                    return res.json();
                })
                .then(json => {
                    if (!json.data || json.data.length === 0) {
                        app.innerHTML = '<div style="text-align:center;padding:20px;color:#999">æš‚æ— å¯ç”¨æ•°æ®</div>';
                        return;
                    }

                    renderCards(json.data);
                    statusTip.style.display = 'none';

                    // å†™å…¥ç¼“å­˜
                    const cacheData = { timestamp: new Date().getTime(), data: json.data };
                    localStorage.setItem(CACHE_KEY, JSON.stringify(cacheData));
                    
                    // æ˜¾ç¤ºæ›´æ–°æˆåŠŸ
                    lockTip.style.display = 'block';
                    lockTip.style.color = '#00b656';
                    lockTip.style.background = '#eafff2';
                    lockTip.style.borderColor = '#b7ebcd';
                    lockTip.innerHTML = forceUpdate 
                        ? `âœ… å¯†ç éªŒè¯é€šè¿‡ï¼Œå·²å¼ºåˆ¶è·å–æœ€æ–°æ•°æ®ï¼` 
                        : `âœ… æ•°æ®å·²æ›´æ–°<br>ä¸‹æ¬¡åˆ·æ–°å°†é”å®š ${LOCK_HOURS} å°æ—¶`;
                })
                .catch(err => {
                    statusTip.innerHTML = "æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ";
                });
        }

        function renderCards(data) {
            const app = document.getElementById('app');
            let html = '';
            data.forEach((item) => {
                html += `
                    <div class="card">
                        <div class="card-header">
                            <div class="region-badge">${item.region || 'æœªçŸ¥åŒºåŸŸ'}</div>
                            <div class="status-badge">â— ${item.status}</div>
                        </div>
                        <div class="row">
                            <div class="label">è´¦å·</div>
                            <div class="value-box">
                                <div class="value-text">${item.username}</div>
                                <button class="copy-btn" onclick="copyText(this, '${item.username}')">å¤åˆ¶</button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="label">å¯†ç </div>
                            <div class="value-box">
                                <div class="value-text">${item.password}</div>
                                <button class="copy-btn" onclick="copyText(this, '${item.password}')">å¤åˆ¶</button>
                            </div>
                        </div>
                        <div class="footer">Check: ${item.checkTime ? item.checkTime.split(' ')[1] : ''}</div>
                    </div>
                `;
            });
            app.innerHTML = html;
        }

        function copyText(btn, text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed'; 
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                const originalText = btn.innerText;
                btn.innerText = 'æˆåŠŸ';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.classList.remove('copied');
                }, 1500);
            } catch (err) { alert('å¤åˆ¶å¤±è´¥'); }
            document.body.removeChild(textarea);
        }

        function openModal(imgElement) {
            var modal = document.getElementById("imageModal");
            var modalImg = document.getElementById("modalImg");
            modal.style.display = "flex";
            modalImg.src = imgElement.src;
        }

        function closeModal() {
            var modal = document.getElementById("imageModal");
            modal.style.display = "none";
        }
    </script>
</body>
</html>
